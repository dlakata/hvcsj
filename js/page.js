"use strict";function onScroll(e){var r=$(document).scrollTop();$("nav a").each(function(){var e=$(this),n=$(e.attr("href"));n.position().top<=r?($("nav ul li a").removeClass("active"),e.addClass("active")):e.removeClass("active")})}var Chess=function(e){function r(){ie=new Array(128),se={w:D,b:D},fe=L,pe={w:0,b:0},ue=D,le=0,ce=1,de=[],he={},s(a())}function n(){t(X)}function t(e){var n=e.split(/\s+/),t=n[0],i=0;if(!o(e).valid)return!1;r();for(var f=0;f<t.length;f++){var u=t.charAt(f);if("/"===u)i+=8;else if(A(u))i+=parseInt(u,10);else{var l="a">u?L:R;p({type:u.toLowerCase(),color:l},$(i)),i++}}return fe=n[1],n[2].indexOf("K")>-1&&(pe.w|=V.KSIDE_CASTLE),n[2].indexOf("Q")>-1&&(pe.w|=V.QSIDE_CASTLE),n[2].indexOf("k")>-1&&(pe.b|=V.KSIDE_CASTLE),n[2].indexOf("q")>-1&&(pe.b|=V.QSIDE_CASTLE),ue="-"===n[3]?D:oe[n[3]],le=parseInt(n[4],10),ce=parseInt(n[5],10),s(a()),!0}function o(e){var r={0:"No errors.",1:"FEN string must contain six space-delimited fields.",2:"6th field (move number) must be a positive integer.",3:"5th field (half move counter) must be a non-negative integer.",4:"4th field (en-passant square) is invalid.",5:"3rd field (castling availability) is invalid.",6:"2nd field (side to move) is invalid.",7:"1st field (piece positions) does not contain 8 '/'-delimited rows.",8:"1st field (piece positions) is invalid [consecutive numbers].",9:"1st field (piece positions) is invalid [invalid piece].",10:"1st field (piece positions) is invalid [row too large]."},n=e.split(/\s+/);if(6!==n.length)return{valid:!1,error_number:1,error:r[1]};if(isNaN(n[5])||parseInt(n[5],10)<=0)return{valid:!1,error_number:2,error:r[2]};if(isNaN(n[4])||parseInt(n[4],10)<0)return{valid:!1,error_number:3,error:r[3]};if(!/^(-|[abcdefgh][36])$/.test(n[3]))return{valid:!1,error_number:4,error:r[4]};if(!/^(KQ?k?q?|Qk?q?|kq?|q|-)$/.test(n[2]))return{valid:!1,error_number:5,error:r[5]};if(!/^(w|b)$/.test(n[1]))return{valid:!1,error_number:6,error:r[6]};var t=n[0].split("/");if(8!==t.length)return{valid:!1,error_number:7,error:r[7]};for(var o=0;o<t.length;o++){for(var a=0,i=!1,s=0;s<t[o].length;s++)if(isNaN(t[o][s])){if(!/^[prnbqkPRNBQK]$/.test(t[o][s]))return{valid:!1,error_number:9,error:r[9]};a+=1,i=!1}else{if(i)return{valid:!1,error_number:8,error:r[8]};a+=parseInt(t[o][s],10),i=!0}if(8!==a)return{valid:!1,error_number:10,error:r[10]}}return{valid:!0,error_number:0,error:r[0]}}function a(){for(var e=0,r="",n=oe.a8;n<=oe.h1;n++){if(null==ie[n])e++;else{e>0&&(r+=e,e=0);var t=ie[n].color,o=ie[n].type;r+=t===L?o.toUpperCase():o.toLowerCase()}n+1&136&&(e>0&&(r+=e),n!==oe.h1&&(r+="/"),e=0,n+=8)}var a="";pe[L]&V.KSIDE_CASTLE&&(a+="K"),pe[L]&V.QSIDE_CASTLE&&(a+="Q"),pe[R]&V.KSIDE_CASTLE&&(a+="k"),pe[R]&V.QSIDE_CASTLE&&(a+="q"),a=a||"-";var i=ue===D?"-":$(ue);return[r,fe,a,i,le,ce].join(" ")}function i(e){for(var r=0;r<e.length;r+=2)"string"==typeof e[r]&&"string"==typeof e[r+1]&&(he[e[r]]=e[r+1]);return he}function s(e){de.length>0||(e!==X?(he.SetUp="1",he.FEN=e):(delete he.SetUp,delete he.FEN))}function f(e){var r=ie[oe[e]];return r?{type:r.type,color:r.color}:null}function p(e,r){if(!("type"in e&&"color"in e))return!1;if(-1===J.indexOf(e.type.toLowerCase()))return!1;if(!(r in oe))return!1;var n=oe[r];return e.type==j&&se[e.color]!=D&&se[e.color]!=n?!1:(ie[n]={type:e.type,color:e.color},e.type===j&&(se[e.color]=n),s(a()),!0)}function u(e){var r=f(e);return ie[oe[e]]=null,r&&r.type===j&&(se[r.color]=D),s(a()),r}function l(e,r,n,t,o){var a={color:fe,from:r,to:n,flags:t,piece:e[r].type};return o&&(a.flags|=V.PROMOTION,a.promotion=o),e[n]?a.captured=e[n].type:t&V.EP_CAPTURE&&(a.captured=B),a}function c(e){function r(e,r,n,t,o){if(e[n].type!==B||T(t)!==te&&T(t)!==ee)r.push(l(e,n,t,o));else for(var a=[M,U,K,Q],i=0,s=a.length;s>i;i++)r.push(l(e,n,t,o,a[i]))}var n=[],t=fe,o=x(t),a={b:ne,w:re},i=oe.a8,s=oe.h1,f=!1,p="undefined"!=typeof e&&"legal"in e?e.legal:!0;if("undefined"!=typeof e&&"square"in e){if(!(e.square in oe))return[];i=s=oe[e.square],f=!0}for(var u=i;s>=u;u++)if(136&u)u+=7;else{var c=ie[u];if(null!=c&&c.color===t)if(c.type===B){var d=u+F[t][0];if(null==ie[d]){r(ie,n,u,d,V.NORMAL);var d=u+F[t][1];a[t]===T(u)&&null==ie[d]&&r(ie,n,u,d,V.BIG_PAWN)}for(g=2;4>g;g++){var d=u+F[t][g];136&d||(null!=ie[d]&&ie[d].color===o?r(ie,n,u,d,V.CAPTURE):d===ue&&r(ie,n,u,ue,V.EP_CAPTURE))}}else for(var g=0,m=G[c.type].length;m>g;g++)for(var b=G[c.type][g],d=u;;){if(d+=b,136&d)break;if(null!=ie[d]){if(ie[d].color===t)break;r(ie,n,u,d,V.CAPTURE);break}if(r(ie,n,u,d,V.NORMAL),"n"===c.type||"k"===c.type)break}}if(!f||s===se[t]){if(pe[t]&V.KSIDE_CASTLE){var w=se[t],y=w+2;null!=ie[w+1]||null!=ie[y]||h(o,se[t])||h(o,w+1)||h(o,y)||r(ie,n,se[t],y,V.KSIDE_CASTLE)}if(pe[t]&V.QSIDE_CASTLE){var w=se[t],y=w-2;null!=ie[w-1]||null!=ie[w-2]||null!=ie[w-3]||h(o,se[t])||h(o,w-1)||h(o,y)||r(ie,n,se[t],y,V.QSIDE_CASTLE)}}if(!p)return n;for(var E=[],u=0,m=n.length;m>u;u++)P(n[u]),v(t)||E.push(n[u]),S();return E}function d(e){var r="";if(e.flags&V.KSIDE_CASTLE)r="O-O";else if(e.flags&V.QSIDE_CASTLE)r="O-O-O";else{var n=C(e);e.piece!==B&&(r+=e.piece.toUpperCase()+n),e.flags&(V.CAPTURE|V.EP_CAPTURE)&&(e.piece===B&&(r+=$(e.from)[0]),r+="x"),r+=$(e.to),e.flags&V.PROMOTION&&(r+="="+e.promotion.toUpperCase())}return P(e),g()&&(r+=m()?"#":"+"),S(),r}function h(e,r){for(var n=oe.a8;n<=oe.h1;n++)if(136&n)n+=7;else if(null!=ie[n]&&ie[n].color===e){var t=ie[n],o=n-r,a=o+119;if(W[a]&1<<H[t.type]){if(t.type===B){if(o>0){if(t.color===L)return!0}else if(t.color===R)return!0;continue}if("n"===t.type||"k"===t.type)return!0;for(var i=z[a],s=n+i,f=!1;s!==r;){if(null!=ie[s]){f=!0;break}s+=i}if(!f)return!0}}return!1}function v(e){return h(x(e),se[e])}function g(){return v(fe)}function m(){return g()&&0===c().length}function b(){return!g()&&0===c().length}function w(){for(var e={},r=[],n=0,t=0,o=oe.a8;o<=oe.h1;o++)if(t=(t+1)%2,136&o)o+=7;else{var a=ie[o];a&&(e[a.type]=a.type in e?e[a.type]+1:1,a.type===K&&r.push(t),n++)}if(2===n)return!0;if(3===n&&(1===e[K]||1===e[Q]))return!0;if(n===e[K]+2){for(var i=0,s=r.length,o=0;s>o;o++)i+=r[o];if(0===i||i===s)return!0}return!1}function y(){for(var e=[],r={},n=!1;;){var t=S();if(!t)break;e.push(t)}for(;;){var o=a().split(" ").slice(0,4).join(" ");if(r[o]=o in r?r[o]+1:1,r[o]>=3&&(n=!0),!e.length)break;P(e.pop())}return n}function E(e){de.push({move:e,kings:{b:se.b,w:se.w},turn:fe,castling:{b:pe.b,w:pe.w},ep_square:ue,half_moves:le,move_number:ce})}function P(e){var r=fe,n=x(r);if(E(e),ie[e.to]=ie[e.from],ie[e.from]=null,e.flags&V.EP_CAPTURE&&(fe===R?ie[e.to-16]=null:ie[e.to+16]=null),e.flags&V.PROMOTION&&(ie[e.to]={type:e.promotion,color:r}),ie[e.to].type===j){if(se[ie[e.to].color]=e.to,e.flags&V.KSIDE_CASTLE){var t=e.to-1,o=e.to+1;ie[t]=ie[o],ie[o]=null}else if(e.flags&V.QSIDE_CASTLE){var t=e.to+1,o=e.to-2;ie[t]=ie[o],ie[o]=null}pe[r]=""}if(pe[r])for(var a=0,i=ae[r].length;i>a;a++)if(e.from===ae[r][a].square&&pe[r]&ae[r][a].flag){pe[r]^=ae[r][a].flag;break}if(pe[n])for(var a=0,i=ae[n].length;i>a;a++)if(e.to===ae[n][a].square&&pe[n]&ae[n][a].flag){pe[n]^=ae[n][a].flag;break}ue=e.flags&V.BIG_PAWN?"b"===fe?e.to-16:e.to+16:D,e.piece===B?le=0:e.flags&(V.CAPTURE|V.EP_CAPTURE)?le=0:le++,fe===R&&ce++,fe=x(fe)}function S(){var e=de.pop();if(null==e)return null;var r=e.move;se=e.kings,fe=e.turn,pe=e.castling,ue=e.ep_square,le=e.half_moves,ce=e.move_number;var n=fe,t=x(fe);if(ie[r.from]=ie[r.to],ie[r.from].type=r.piece,ie[r.to]=null,r.flags&V.CAPTURE)ie[r.to]={type:r.captured,color:t};else if(r.flags&V.EP_CAPTURE){var o;o=n===R?r.to-16:r.to+16,ie[o]={type:B,color:t}}if(r.flags&(V.KSIDE_CASTLE|V.QSIDE_CASTLE)){var a,i;r.flags&V.KSIDE_CASTLE?(a=r.to+1,i=r.to-1):r.flags&V.QSIDE_CASTLE&&(a=r.to-2,i=r.to+1),ie[a]=ie[i],ie[i]=null}return r}function C(e){for(var r=c(),n=e.from,t=e.to,o=e.piece,a=0,i=0,s=0,f=0,p=r.length;p>f;f++){var u=r[f].from,l=r[f].to,d=r[f].piece;o===d&&n!==u&&t===l&&(a++,T(n)===T(u)&&i++,_(n)===_(u)&&s++)}return a>0?i>0&&s>0?$(n):$(n).charAt(s>0?1:0):""}function O(){for(var e="   +------------------------+\n",r=oe.a8;r<=oe.h1;r++){if(0===_(r)&&(e+=" "+"87654321"[T(r)]+" |"),null==ie[r])e+=" . ";else{var n=ie[r].type,t=ie[r].color,o=t===L?n.toUpperCase():n.toLowerCase();e+=" "+o+" "}r+1&136&&(e+="|\n",r+=8)}return e+="   +------------------------+\n",e+="     a  b  c  d  e  f  g  h\n"}function T(e){return e>>4}function _(e){return 15&e}function $(e){var r=_(e),n=T(e);return"abcdefgh".substring(r,r+1)+"87654321".substring(n,n+1)}function x(e){return e===L?R:L}function A(e){return-1!=="0123456789".indexOf(e)}function I(e){var r=k(e);r.san=d(r),r.to=$(r.to),r.from=$(r.from);var n="";for(var t in V)V[t]&r.flags&&(n+=Z[t]);return r.flags=n,r}function k(e){var r=e instanceof Array?[]:{};for(var n in e)r[n]="object"==typeof n?k(e[n]):e[n];return r}function q(e){return e.replace(/^\s+|\s+$/g,"")}function N(e){for(var r=c({legal:!1}),n=0,t=fe,o=0,a=r.length;a>o;o++){if(P(r[o]),!v(t))if(e-1>0){var i=N(e-1);n+=i}else n++;S()}return n}var R="b",L="w",D=-1,B="p",Q="n",K="b",U="r",M="q",j="k",J="pnbrqkPNBRQK",X="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",Y=["1-0","0-1","1/2-1/2","*"],F={b:[16,32,17,15],w:[-16,-32,-17,-15]},G={n:[-18,-33,-31,-14,18,33,31,14],b:[-17,-15,17,15],r:[-16,1,16,-1],q:[-17,-16,-15,1,17,16,15,-1],k:[-17,-16,-15,1,17,16,15,-1]},W=[20,0,0,0,0,0,0,24,0,0,0,0,0,0,20,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,24,24,24,24,24,24,56,0,56,24,24,24,24,24,24,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,20,0,0,0,0,0,0,24,0,0,0,0,0,0,20],z=[17,0,0,0,0,0,0,16,0,0,0,0,0,0,15,0,0,17,0,0,0,0,0,16,0,0,0,0,0,15,0,0,0,0,17,0,0,0,0,16,0,0,0,0,15,0,0,0,0,0,0,17,0,0,0,16,0,0,0,15,0,0,0,0,0,0,0,0,17,0,0,16,0,0,15,0,0,0,0,0,0,0,0,0,0,17,0,16,0,15,0,0,0,0,0,0,0,0,0,0,0,0,17,16,15,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,-15,-16,-17,0,0,0,0,0,0,0,0,0,0,0,0,-15,0,-16,0,-17,0,0,0,0,0,0,0,0,0,0,-15,0,0,-16,0,0,-17,0,0,0,0,0,0,0,0,-15,0,0,0,-16,0,0,0,-17,0,0,0,0,0,0,-15,0,0,0,0,-16,0,0,0,0,-17,0,0,0,0,-15,0,0,0,0,0,-16,0,0,0,0,0,-17,0,0,-15,0,0,0,0,0,0,-16,0,0,0,0,0,0,-17],H={p:0,n:1,b:2,r:3,q:4,k:5},Z={NORMAL:"n",CAPTURE:"c",BIG_PAWN:"b",EP_CAPTURE:"e",PROMOTION:"p",KSIDE_CASTLE:"k",QSIDE_CASTLE:"q"},V={NORMAL:1,CAPTURE:2,BIG_PAWN:4,EP_CAPTURE:8,PROMOTION:16,KSIDE_CASTLE:32,QSIDE_CASTLE:64},ee=7,re=6,ne=1,te=0,oe={a8:0,b8:1,c8:2,d8:3,e8:4,f8:5,g8:6,h8:7,a7:16,b7:17,c7:18,d7:19,e7:20,f7:21,g7:22,h7:23,a6:32,b6:33,c6:34,d6:35,e6:36,f6:37,g6:38,h6:39,a5:48,b5:49,c5:50,d5:51,e5:52,f5:53,g5:54,h5:55,a4:64,b4:65,c4:66,d4:67,e4:68,f4:69,g4:70,h4:71,a3:80,b3:81,c3:82,d3:83,e3:84,f3:85,g3:86,h3:87,a2:96,b2:97,c2:98,d2:99,e2:100,f2:101,g2:102,h2:103,a1:112,b1:113,c1:114,d1:115,e1:116,f1:117,g1:118,h1:119},ae={w:[{square:oe.a1,flag:V.QSIDE_CASTLE},{square:oe.h1,flag:V.KSIDE_CASTLE}],b:[{square:oe.a8,flag:V.QSIDE_CASTLE},{square:oe.h8,flag:V.KSIDE_CASTLE}]},ie=new Array(128),se={w:D,b:D},fe=L,pe={w:0,b:0},ue=D,le=0,ce=1,de=[],he={};return t("undefined"==typeof e?X:e),{WHITE:L,BLACK:R,PAWN:B,KNIGHT:Q,BISHOP:K,ROOK:U,QUEEN:M,KING:j,SQUARES:function(){for(var e=[],r=oe.a8;r<=oe.h1;r++)136&r?r+=7:e.push($(r));return e}(),FLAGS:Z,load:function(e){return t(e)},reset:function(){return n()},moves:function(e){for(var r=c(e),n=[],t=0,o=r.length;o>t;t++)n.push("undefined"!=typeof e&&"verbose"in e&&e.verbose?I(r[t]):d(r[t]));return n},in_check:function(){return g()},in_checkmate:function(){return m()},in_stalemate:function(){return b()},in_draw:function(){return le>=100||b()||w()||y()},insufficient_material:function(){return w()},in_threefold_repetition:function(){return y()},game_over:function(){return le>=100||m()||b()||w()||y()},validate_fen:function(e){return o(e)},fen:function(){return a()},pgn:function(e){var r="object"==typeof e&&"string"==typeof e.newline_char?e.newline_char:"\n",n="object"==typeof e&&"number"==typeof e.max_width?e.max_width:0,t=[],o=!1;for(var a in he)t.push("["+a+' "'+he[a]+'"]'+r),o=!0;o&&de.length&&t.push(r);for(var i=[];de.length>0;)i.push(S());for(var s=[],f="",p=1;i.length>0;){var u=i.pop();1===p&&"b"===u.color?(f="1. ...",p++):"w"===u.color&&(f.length&&s.push(f),f=p+".",p++),f=f+" "+d(u),P(u)}if(f.length&&s.push(f),"undefined"!=typeof he.Result&&s.push(he.Result),0===n)return t.join("")+s.join(" ");for(var l=0,a=0;a<s.length;a++)l+s[a].length>n&&0!==a?(" "===t[t.length-1]&&t.pop(),t.push(r),l=0):0!==a&&(t.push(" "),l++),t.push(s[a]),l+=s[a].length;return t.join("")},load_pgn:function(e,r){function o(e){return e.replace(/\\/g,"\\")}function a(e){for(var r=e.replace(/[+#?!=]/,""),n=c(),t=0,o=n.length;o>t;t++)if(r==d(n[t]).replace(/[+#?!=]/,""))return n[t];return null}function s(e){return a(q(e))}function f(e){var r=!1;for(var n in e)r=!0;return r}function p(e,r){for(var n="object"==typeof r&&"string"==typeof r.newline_char?r.newline_char:"\r?\n",t={},a=e.split(new RegExp(o(n))),i="",s="",f=0;f<a.length;f++)i=a[f].replace(/^\[([A-Z][A-Za-z]*)\s.*\]$/,"$1"),s=a[f].replace(/^\[[A-Za-z]+\s"(.*)"\]$/,"$1"),q(i).length>0&&(t[i]=s);return t}var u="object"==typeof r&&"string"==typeof r.newline_char?r.newline_char:"\r?\n",l=new RegExp("^(\\[(.|"+o(u)+")*\\])("+o(u)+")*1.("+o(u)+"|.)*$","g"),h=e.replace(l,"$1");"["!==h[0]&&(h=""),n();var v=p(h,r);for(var g in v)i([g,v[g]]);if("1"===v.SetUp&&!("FEN"in v&&t(v.FEN)))return!1;var m=e.replace(h,"").replace(new RegExp(o(u),"g")," ");m=m.replace(/(\{[^}]+\})+?/g,""),m=m.replace(/\d+\./g,""),m=m.replace(/\.\.\./g,"");var b=q(m).split(new RegExp(/\s+/));b=b.join(",").replace(/,,+/g,",").split(",");for(var w="",y=0;y<b.length-1;y++){if(w=s(b[y]),null==w)return!1;P(w)}if(w=b[b.length-1],Y.indexOf(w)>-1)f(he)&&"undefined"==typeof he.Result&&i(["Result",w]);else{if(w=s(w),null==w)return!1;P(w)}return!0},header:function(){return i(arguments)},ascii:function(){return O()},turn:function(){return fe},move:function(e){var r=null,n=c();if("string"==typeof e){for(var t=e.replace(/[+#?!=]/,""),o=0,a=n.length;a>o;o++)if(t===d(n[o]).replace(/[+#?!=]/,"")){r=n[o];break}}else if("object"==typeof e)for(var o=0,a=n.length;a>o;o++)if(!(e.from!==$(n[o].from)||e.to!==$(n[o].to)||"promotion"in n[o]&&e.promotion!==n[o].promotion)){r=n[o];break}if(!r)return null;var i=I(r);return P(r),i},undo:function(){var e=S();return e?I(e):null},clear:function(){return r()},put:function(e,r){return p(e,r)},get:function(e){return f(e)},remove:function(e){return u(e)},perft:function(e){return N(e)},square_color:function(e){if(e in oe){var r=oe[e];return(T(r)+_(r))%2===0?"light":"dark"}return null},history:function(e){for(var r=[],n=[],t=("undefined"!=typeof e&&"verbose"in e&&e.verbose);de.length>0;)r.push(S());for(;r.length>0;){var o=r.pop();n.push(t?I(o):d(o)),P(o)}return n}}};"undefined"!=typeof exports&&(exports.Chess=Chess),"undefined"!=typeof define&&define(function(){return Chess}),function(){function e(e){return"string"!=typeof e?!1:-1!==e.search(/^[a-h][1-8]$/)}function r(e){if("string"!=typeof e)return!1;if(e=e.replace(/ .+$/,""),e=e.split("/"),8!==e.length)return!1;for(var r=0;8>r;r++)if(""===e[r]||8<e[r].length||-1!==e[r].search(/[^kqrbnpKQRNBP1-8]/))return!1;return!0}function n(r){if("object"!=typeof r)return!1;for(var n in r)if(!0===r.hasOwnProperty(n)){var t;if((t=!0!==e(n))||(t=r[n],t="string"!=typeof t?!1:-1!==t.search(/^[bw][KQRNBP]$/),t=!0!==t),t)return!1}return!0}function t(e){if(!0!==r(e))return!1;e=e.replace(/ .+$/,""),e=e.split("/");for(var n={},t=8,o=0;8>o;o++){for(var i=e[o].split(""),s=0,f=0;f<i.length;f++)if(-1!==i[f].search(/[1-8]/))var p=parseInt(i[f],10),s=s+p;else{var u,p=n,l=a[s]+t;u=i[f],u=u.toLowerCase()===u?"b"+u.toUpperCase():"w"+u.toUpperCase(),p[l]=u,s++}t--}return n}function o(e){if(!0!==n(e))return!1;for(var r="",t=8,o=0;8>o;o++){for(var i=0;8>i;i++){var s=a[i]+t;!0===e.hasOwnProperty(s)?(s=e[s].split(""),s="w"===s[0]?s[1].toUpperCase():s[1].toLowerCase(),r+=s):r+="1"}7!==o&&(r+="/"),t--}return r=r.replace(/11111111/g,"8"),r=r.replace(/1111111/g,"7"),r=r.replace(/111111/g,"6"),r=r.replace(/11111/g,"5"),r=r.replace(/1111/g,"4"),r=r.replace(/111/g,"3"),r=r.replace(/11/g,"2")}var a="abcdefgh".split("");window.ChessBoard=window.ChessBoard||function(i,s){function f(){return"xxxx-xxxx-xxxx-xxxx-xxxx-xxxx-xxxx-xxxx".replace(/x/g,function(e){return(16*Math.random()|0).toString(16)})}function p(e){return JSON.parse(JSON.stringify(e))}function u(e){return e=e.split("."),{major:parseInt(e[0],10),minor:parseInt(e[1],10),patch:parseInt(e[2],10)}}function l(e,r,n){if(!0===s.hasOwnProperty("showErrors")&&!1!==s.showErrors){var t="ChessBoard Error "+e+": "+r;"console"===s.showErrors&&"object"==typeof console&&"function"==typeof console.log?(console.log(t),2<=arguments.length&&console.log(n)):"alert"===s.showErrors?(n&&(t+="\n\n"+JSON.stringify(n)),window.alert(t)):"function"==typeof s.showErrors&&s.showErrors(e,r,n)}}function c(e){return"fast"===e||"slow"===e?!0:parseInt(e,10)+""!=e+""?!1:e>=0}function d(){for(var e=0;e<a.length;e++)for(var r=1;8>=r;r++){var n=a[e]+r;de[n]=n+"-"+f()}for(r="KQRBNP".split(""),e=0;e<r.length;e++){var n="w"+r[e],t="b"+r[e];ce[n]=n+"-"+f(),ce[t]=t+"-"+f()}}function h(){var e='<div class="'+ie.chessboard+'">';return!0===s.sparePieces&&(e+='<div class="'+ie.sparePieces+" "+ie.sparePiecesTop+'"></div>'),e+='<div class="'+ie.board+'"></div>',!0===s.sparePieces&&(e+='<div class="'+ie.sparePieces+" "+ie.sparePiecesBottom+'"></div>'),e+"</div>"}function v(e){"black"!==e&&(e="white");var r="",n=p(a),t=8;"black"===e&&(n.reverse(),t=1);for(var o="white",i=0;8>i;i++){for(var r=r+('<div class="'+ie.row+'">'),f=0;8>f;f++){var u=n[f]+t,r=r+('<div class="'+ie.square+" "+ie[o]+" square-"+u+'" style="width: '+ee+"px; height: "+ee+'px" id="'+de[u]+'" data-square="'+u+'">');!0===s.showNotation&&(("white"===e&&1===t||"black"===e&&8===t)&&(r+='<div class="'+ie.notation+" "+ie.alpha+'">'+n[f]+"</div>"),0===f&&(r+='<div class="'+ie.notation+" "+ie.numeric+'">'+t+"</div>")),r+="</div>",o="white"===o?"black":"white"}r+='<div class="'+ie.clearfix+'"></div></div>',o="white"===o?"black":"white","white"===e?t--:t++}return r}function g(e){return"function"==typeof s.pieceTheme?s.pieceTheme(e):"string"==typeof s.pieceTheme?s.pieceTheme.replace(/{piece}/g,e):(l(8272,"Unable to build image source for cfg.pieceTheme."),"")}function m(e,r,n){var t='<img src="'+g(e)+'" ';return n&&"string"==typeof n&&(t+='id="'+n+'" '),t+='alt="" class="'+ie.piece+'" data-piece="'+e+'" style="width: '+ee+"px;height: "+ee+"px;",!0===r&&(t+="display:none;"),t+'" />'}function b(e){var r="wK wQ wR wB wN wP".split(" ");"black"===e&&(r="bK bQ bR bB bN bP".split(" ")),e="";for(var n=0;n<r.length;n++)e+=m(r[n],!1,ce[r[n]]);return e}function w(e,r,n,t){e=$("#"+de[e]);var o=e.offset(),a=$("#"+de[r]);r=a.offset();var i=f();$("body").append(m(n,!0,i));var p=$("#"+i);p.css({display:"",position:"absolute",top:o.top,left:o.left}),e.find("."+ie.piece).remove(),p.animate(r,{duration:s.moveSpeed,complete:function(){a.append(m(n)),p.remove(),"function"==typeof t&&t()}})}function y(e,r,n){var t=$("#"+ce[e]).offset(),o=$("#"+de[r]);r=o.offset();var a=f();$("body").append(m(e,!0,a));var i=$("#"+a);i.css({display:"",position:"absolute",left:t.left,top:t.top}),i.animate(r,{duration:s.moveSpeed,complete:function(){o.find("."+ie.piece).remove(),o.append(m(e)),i.remove(),"function"==typeof n&&n()}})}function E(e,r,n){function t(){o++,o===e.length&&(C(),!0===s.hasOwnProperty("onMoveEnd")&&"function"==typeof s.onMoveEnd)&&s.onMoveEnd(p(r),p(n))}for(var o=0,a=0;a<e.length;a++)"clear"===e[a].type&&$("#"+de[e[a].square]+" ."+ie.piece).fadeOut(s.trashSpeed,t),"add"===e[a].type&&!0!==s.sparePieces&&$("#"+de[e[a].square]).append(m(e[a].piece,!0)).find("."+ie.piece).fadeIn(s.appearSpeed,t),"add"===e[a].type&&!0===s.sparePieces&&y(e[a].piece,e[a].square,t),"move"===e[a].type&&w(e[a].source,e[a].destination,e[a].piece,t)}function P(e,r){e=e.split("");var n=a.indexOf(e[0])+1,t=parseInt(e[1],10);r=r.split("");var o=a.indexOf(r[0])+1,i=parseInt(r[1],10),n=Math.abs(n-o),t=Math.abs(t-i);return n>=t?n:t}function S(e){for(var r=[],n=0;8>n;n++)for(var t=0;8>t;t++){var o=a[n]+(t+1);e!==o&&r.push({square:o,distance:P(e,o)})}for(r.sort(function(e,r){return e.distance-r.distance}),e=[],n=0;n<r.length;n++)e.push(r[n].square);return e}function C(){z.find("."+ie.piece).remove();for(var e in ue)!0===ue.hasOwnProperty(e)&&$("#"+de[e]).append(m(ue[e]))}function O(){z.html(v(pe)),C(),!0===s.sparePieces&&("white"===pe?(Z.html(b("black")),V.html(b("white"))):(Z.html(b("white")),V.html(b("black"))))}function T(e){var r=p(ue),n=p(e),t=o(r),a=o(n);t!==a&&(!0===s.hasOwnProperty("onChange")&&"function"==typeof s.onChange&&s.onChange(r,n),ue=e)}function _(e,r){for(var n in oe)if(!0===oe.hasOwnProperty(n)){var t=oe[n];if(e>=t.left&&e<t.left+ee&&r>=t.top&&r<t.top+ee)return n}return"offboard"}function x(){z.find("."+ie.square).removeClass(ie.highlight1+" "+ie.highlight2)}function A(){function e(){C(),H.css("display","none"),!0===s.hasOwnProperty("onSnapbackEnd")&&"function"==typeof s.onSnapbackEnd&&s.onSnapbackEnd(re,te,p(ue),pe)}if("spare"===te)I();else{x();var r=$("#"+de[te]).offset();H.animate(r,{duration:s.snapbackSpeed,complete:e}),le=!1}}function I(){x();var e=p(ue);delete e[te],T(e),C(),H.fadeOut(s.trashSpeed),le=!1}function k(e){x();var r=p(ue);delete r[te],r[e]=re,T(r),r=$("#"+de[e]).offset(),H.animate(r,{duration:s.snapSpeed,complete:function(){C(),H.css("display","none"),!0===s.hasOwnProperty("onSnapEnd")&&"function"==typeof s.onSnapEnd&&s.onSnapEnd(te,e,re)}}),le=!1}function q(e,r,n,t){if("function"!=typeof s.onDragStart||!1!==s.onDragStart(e,r,p(ue),pe)){le=!0,re=r,te=e,ne="spare"===e?"offboard":e,oe={};for(var o in de)!0===de.hasOwnProperty(o)&&(oe[o]=$("#"+de[o]).offset());H.attr("src",g(r)).css({display:"",position:"absolute",left:n-ee/2,top:t-ee/2}),"spare"!==e&&$("#"+de[e]).addClass(ie.highlight1).find("."+ie.piece).css("display","none")}}function N(r,n){H.css({left:r-ee/2,top:n-ee/2});var t=_(r,n);t!==ne&&(!0===e(ne)&&$("#"+de[ne]).removeClass(ie.highlight2),!0===e(t)&&$("#"+de[t]).addClass(ie.highlight2),"function"==typeof s.onDragMove&&s.onDragMove(t,ne,te,re,p(ue),pe),ne=t)}function R(r){var n="drop";if("offboard"===r&&"snapback"===s.dropOffBoard&&(n="snapback"),"offboard"===r&&"trash"===s.dropOffBoard&&(n="trash"),!0===s.hasOwnProperty("onDrop")&&"function"==typeof s.onDrop){var t=p(ue);"spare"===te&&!0===e(r)&&(t[r]=re),!0===e(te)&&"offboard"===r&&delete t[te],!0===e(te)&&!0===e(r)&&(delete t[te],t[r]=re);var o=p(ue),t=s.onDrop(te,r,re,t,o,pe);("snapback"===t||"trash"===t)&&(n=t)}"snapback"===n?A():"trash"===n?I():"drop"===n&&k(r)}function L(e){e.preventDefault()}function D(r){if(!0===s.draggable){var n=$(this).attr("data-square");!0===e(n)&&!0===ue.hasOwnProperty(n)&&q(n,ue[n],r.pageX,r.pageY)}}function B(r){if(!0===s.draggable){var n=$(this).attr("data-square");!0===e(n)&&!0===ue.hasOwnProperty(n)&&(r=r.originalEvent,q(n,ue[n],r.changedTouches[0].pageX,r.changedTouches[0].pageY))}}function Q(e){if(!0===s.sparePieces){var r=$(this).attr("data-piece");q("spare",r,e.pageX,e.pageY)}}function K(e){if(!0===s.sparePieces){var r=$(this).attr("data-piece");e=e.originalEvent,q("spare",r,e.changedTouches[0].pageX,e.changedTouches[0].pageY)}}function U(e){!0===le&&N(e.pageX,e.pageY)}function M(e){!0===le&&(e.preventDefault(),N(e.originalEvent.changedTouches[0].pageX,e.originalEvent.changedTouches[0].pageY))}function j(e){!0===le&&(e=_(e.pageX,e.pageY),R(e))}function J(e){!0===le&&(e=_(e.originalEvent.changedTouches[0].pageX,e.originalEvent.changedTouches[0].pageY),R(e))}function X(r){if(!1===le&&!0===s.hasOwnProperty("onMouseoverSquare")&&"function"==typeof s.onMouseoverSquare&&(r=$(r.currentTarget).attr("data-square"),!0===e(r))){var n=!1;!0===ue.hasOwnProperty(r)&&(n=ue[r]),s.onMouseoverSquare(r,n,p(ue),pe)}}function Y(r){if(!1===le&&!0===s.hasOwnProperty("onMouseoutSquare")&&"function"==typeof s.onMouseoutSquare&&(r=$(r.currentTarget).attr("data-square"),!0===e(r))){var n=!1;!0===ue.hasOwnProperty(r)&&(n=ue[r]),s.onMouseoutSquare(r,n,p(ue),pe)}}function F(){$("body").on("mousedown mousemove","."+ie.piece,L),z.on("mousedown","."+ie.square,D),W.on("mousedown","."+ie.sparePieces+" ."+ie.piece,Q),z.on("mouseenter","."+ie.square,X),z.on("mouseleave","."+ie.square,Y),!0===(navigator&&navigator.userAgent&&-1!==navigator.userAgent.search(/MSIE/))?(document.ondragstart=function(){return!1},$("body").on("mousemove",U),$("body").on("mouseup",j)):($(window).on("mousemove",U),$(window).on("mouseup",j)),!0=="ontouchstart"in document.documentElement&&(z.on("touchstart","."+ie.square,B),W.on("touchstart","."+ie.sparePieces+" ."+ie.piece,K),$(window).on("touchmove",M),$(window).on("touchend",J))}function G(){W.html(h()),z=W.find("."+ie.board),!0===s.sparePieces&&(Z=W.find("."+ie.sparePiecesTop),V=W.find("."+ie.sparePiecesBottom));var e=f();$("body").append(m("wP",!0,e)),H=$("#"+e),fe=parseInt(z.css("borderLeftWidth"),10),se.resize()}s=s||{};var W,z,H,Z,V,ee,re,ne,te,oe,ae=t("rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR"),ie={alpha:"alpha-d2270",black:"black-3c85d",board:"board-b72b1",chessboard:"chessboard-63f37",clearfix:"clearfix-7da63",highlight1:"highlight1-32417",highlight2:"highlight2-9c5d2",notation:"notation-322f9",numeric:"numeric-fc462",piece:"piece-417db",row:"row-5277c",sparePieces:"spare-pieces-7492f",sparePiecesBottom:"spare-pieces-bottom-ae20f",sparePiecesTop:"spare-pieces-top-4028b",square:"square-55d63",white:"white-1e1d7"},se={},fe=2,pe="white",ue={},le=!1,ce={},de={};se.clear=function(e){se.position({},e)},se.destroy=function(){W.html(""),H.remove(),W.unbind()},se.fen=function(){return se.position("fen")},se.flip=function(){se.orientation("flip")},se.move=function(){if(0!==arguments.length){for(var r=!0,n={},t=0;t<arguments.length;t++)if(!1===arguments[t])r=!1;else{var o;o=arguments[t],"string"!=typeof o?o=!1:(o=o.split("-"),o=2!==o.length?!1:!0===e(o[0])&&!0===e(o[1])),!0!==o?l(2826,"Invalid move passed to the move method.",arguments[t]):(o=arguments[t].split("-"),n[o[0]]=o[1])}var a,t=ue,t=p(t);for(a in n)!0===n.hasOwnProperty(a)&&!0===t.hasOwnProperty(a)&&(o=t[a],delete t[a],t[n[a]]=o);return n=t,se.position(n,r),n}},se.orientation=function(e){return 0===arguments.length?pe:void("white"===e||"black"===e?(pe=e,O()):"flip"===e?(pe="white"===pe?"black":"white",O()):l(5482,"Invalid value passed to the orientation method.",e))},se.position=function(e,a){if(0===arguments.length)return p(ue);if("string"==typeof e&&"fen"===e.toLowerCase())return o(ue);if(!1!==a&&(a=!0),"string"==typeof e&&"start"===e.toLowerCase()&&(e=p(ae)),!0===r(e)&&(e=t(e)),!0!==n(e))l(6482,"Invalid value passed to the position method.",e);else if(!0===a){var i,s=ue,f=e,s=p(s),f=p(f),u=[],c={};for(i in f)!0===f.hasOwnProperty(i)&&!0===s.hasOwnProperty(i)&&s[i]===f[i]&&(delete s[i],delete f[i]);for(i in f)if(!0===f.hasOwnProperty(i)){var d;e:{d=s;for(var h=f[i],v=S(i),g=0;g<v.length;g++){var m=v[g];if(!0===d.hasOwnProperty(m)&&d[m]===h){d=m;break e}}d=!1}!1!==d&&(u.push({type:"move",source:d,destination:i,piece:f[i]}),delete s[d],delete f[i],c[i]=!0)}for(i in f)!0===f.hasOwnProperty(i)&&(u.push({type:"add",square:i,piece:f[i]}),delete f[i]);for(i in s)!0===s.hasOwnProperty(i)&&!0!==c.hasOwnProperty(i)&&(u.push({type:"clear",square:i,piece:s[i]}),delete s[i]);E(u,ue,e),T(e)}else T(e),C()},se.resize=function(){var e=parseInt(W.css("width"),10);if(!e||0>=e)ee=0;else{for(e-=1;0!==e%8&&e>0;)e--;ee=e/8}z.css("width",8*ee+"px"),H.css({height:ee,width:ee}),!0===s.sparePieces&&W.find("."+ie.sparePieces).css("paddingLeft",ee+fe+"px"),O()},se.start=function(e){se.position("start",e)};var he;return(he=!0===function(){if("string"==typeof i){if(""===i)return window.alert("ChessBoard Error 1001: The first argument to ChessBoard() cannot be an empty string.\n\nExiting..."),!1;var e=document.getElementById(i);if(!e)return window.alert('ChessBoard Error 1002: Element with id "'+i+'" does not exist in the DOM.\n\nExiting...'),!1;W=$(e)}else if(W=$(i),1!==W.length)return window.alert("ChessBoard Error 1003: The first argument to ChessBoard() must be an ID or a single DOM node.\n\nExiting..."),!1;if(!window.JSON||"function"!=typeof JSON.stringify||"function"!=typeof JSON.parse)return window.alert("ChessBoard Error 1004: JSON does not exist. Please include a JSON polyfill.\n\nExiting..."),!1;if((e=typeof window.$)&&(e=$.fn)&&(e=$.fn.jquery))var e=$.fn.jquery,r="1.7.0",e=u(e),r=u(r),e=!0==1e8*e.major+1e4*e.minor+e.patch>=1e8*r.major+1e4*r.minor+r.patch;return e?!0:(window.alert("ChessBoard Error 1005: Unable to find a valid version of jQuery. Please include jQuery 1.7.0 or higher on the page.\n\nExiting..."),!1)}())&&(("string"==typeof s||!0===n(s))&&(s={position:s}),"black"!==s.orientation&&(s.orientation="white"),pe=s.orientation,!1!==s.showNotation&&(s.showNotation=!0),!0!==s.draggable&&(s.draggable=!1),"trash"!==s.dropOffBoard&&(s.dropOffBoard="snapback"),!0!==s.sparePieces&&(s.sparePieces=!1),!0===s.sparePieces&&(s.draggable=!0),(!0!==s.hasOwnProperty("pieceTheme")||"string"!=typeof s.pieceTheme&&"function"!=typeof s.pieceTheme)&&(s.pieceTheme="img/chesspieces/wikipedia/{piece}.png"),(!0!==s.hasOwnProperty("appearSpeed")||!0!==c(s.appearSpeed))&&(s.appearSpeed=200),(!0!==s.hasOwnProperty("moveSpeed")||!0!==c(s.moveSpeed))&&(s.moveSpeed=200),(!0!==s.hasOwnProperty("snapbackSpeed")||!0!==c(s.snapbackSpeed))&&(s.snapbackSpeed=50),(!0!==s.hasOwnProperty("snapSpeed")||!0!==c(s.snapSpeed))&&(s.snapSpeed=25),(!0!==s.hasOwnProperty("trashSpeed")||!0!==c(s.trashSpeed))&&(s.trashSpeed=100),!0===s.hasOwnProperty("position")&&("start"===s.position?ue=p(ae):!0===r(s.position)?ue=t(s.position):!0===n(s.position)?ue=p(s.position):l(7263,"Invalid value passed to config.position.",s.position)),he=!0),he&&(d(),G(),F()),se},window.ChessBoard.fenToObj=t,window.ChessBoard.objToFen=o}(),$(document).ready(function(){$(document).on("scroll",onScroll),$('a[href^="#"]').on("click",function(e){e.preventDefault(),$(document).off("scroll"),$("a").each(function(){$(this).removeClass("active")}),$(this).addClass("active");var r=this.hash;$target=$(r),$("html, body").stop().animate({scrollTop:$target.offset().top+2},500,"swing",function(){window.location.hash=r,$(document).on("scroll",onScroll)})})});