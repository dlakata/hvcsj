function onScroll(e){var r=$(document).scrollTop();$("nav a").each(function(){var e=$(this),n=$(e.attr("href"));n.position().top<=r+40?($("nav ul li a").removeClass("active"),e.addClass("active")):e.removeClass("active")})}!function(e){var r=null;e.modal=function(n,t){e.modal.close();var o,i;if(this.$body=e("body"),this.options=e.extend({},e.modal.defaults,t),n.is("a"))if(i=n.attr("href"),/^#/.test(i)){if(this.$elm=e(i),1!==this.$elm.length)return null;this.open()}else this.$elm=e("<div>"),this.$body.append(this.$elm),o=function(e,r){r.elm.remove()},this.showSpinner(),n.trigger(e.modal.AJAX_SEND),e.get(i).done(function(t){r&&(n.trigger(e.modal.AJAX_SUCCESS),r.$elm.empty().append(t).on(e.modal.CLOSE,o),r.hideSpinner(),r.open(),n.trigger(e.modal.AJAX_COMPLETE))}).fail(function(){n.trigger(e.modal.AJAX_FAIL),r.hideSpinner(),n.trigger(e.modal.AJAX_COMPLETE)});else this.$elm=n,this.open()},e.modal.prototype={constructor:e.modal,open:function(){this.block(),this.show(),this.options.escapeClose&&e(document).on("keydown.modal",function(r){27==r.which&&e.modal.close()}),this.options.clickClose&&this.blocker.click(e.modal.close)},close:function(){this.unblock(),this.hide(),e(document).off("keydown.modal")},block:function(){this.$elm.trigger(e.modal.BEFORE_BLOCK,[this._ctx()]),this.blocker=e('<div class="jquery-modal blocker"></div>').css({top:0,right:0,bottom:0,left:0,width:"100%",height:"100%",position:"fixed",zIndex:this.options.zIndex,background:this.options.overlay,opacity:this.options.opacity}),this.$body.append(this.blocker),this.$elm.trigger(e.modal.BLOCK,[this._ctx()])},unblock:function(){this.blocker.remove()},show:function(){this.$elm.trigger(e.modal.BEFORE_OPEN,[this._ctx()]),this.options.showClose&&(this.closeButton=e('<a href="#close-modal" rel="modal:close" class="close-modal">'+this.options.closeText+"</a>"),this.$elm.append(this.closeButton)),this.$elm.addClass(this.options.modalClass+" current"),this.center(),this.$elm.show().trigger(e.modal.OPEN,[this._ctx()])},hide:function(){this.$elm.trigger(e.modal.BEFORE_CLOSE,[this._ctx()]),this.closeButton&&this.closeButton.remove(),this.$elm.removeClass("current").hide(),this.$elm.trigger(e.modal.CLOSE,[this._ctx()])},showSpinner:function(){this.options.showSpinner&&(this.spinner=this.spinner||e('<div class="'+this.options.modalClass+'-spinner"></div>').append(this.options.spinnerHtml),this.$body.append(this.spinner),this.spinner.show())},hideSpinner:function(){this.spinner&&this.spinner.remove()},center:function(){this.$elm.css({position:"fixed",top:"50%",left:"50%",marginTop:-(this.$elm.outerHeight()/2),marginLeft:-(this.$elm.outerWidth()/2),zIndex:this.options.zIndex+1})},_ctx:function(){return{elm:this.$elm,blocker:this.blocker,options:this.options}}},e.modal.prototype.resize=e.modal.prototype.center,e.modal.close=function(e){r&&(e&&e.preventDefault(),r.close(),r=null)},e.modal.resize=function(){r&&r.resize()},e.modal.defaults={overlay:"#000",opacity:.75,zIndex:1,escapeClose:!0,clickClose:!0,closeText:"Close",modalClass:"modal",spinnerHtml:null,showSpinner:!0,showClose:!0},e.modal.BEFORE_BLOCK="modal:before-block",e.modal.BLOCK="modal:block",e.modal.BEFORE_OPEN="modal:before-open",e.modal.OPEN="modal:open",e.modal.BEFORE_CLOSE="modal:before-close",e.modal.CLOSE="modal:close",e.modal.AJAX_SEND="modal:ajax:send",e.modal.AJAX_SUCCESS="modal:ajax:success",e.modal.AJAX_FAIL="modal:ajax:fail",e.modal.AJAX_COMPLETE="modal:ajax:complete",e.fn.modal=function(n){return 1===this.length&&(r=new e.modal(this,n)),this},e(document).on("click",'a[rel="modal:close"]',e.modal.close),e(document).on("click",'a[rel="modal:open"]',function(r){r.preventDefault(),e(this).modal()})}(jQuery);var Chess=function(e){function r(){ae=new Array(128),se={w:R,b:R},le=B,fe={w:0,b:0},pe=R,ce=0,ue=1,de=[],he={},s(i())}function n(){t(X)}function t(e){var n=e.split(/\s+/),t=n[0],a=0;if(!o(e).valid)return!1;r();for(var l=0;l<t.length;l++){var p=t.charAt(l);if("/"===p)a+=8;else if(T(p))a+=parseInt(p,10);else{var c="a">p?B:N;f({type:p.toLowerCase(),color:c},x(a)),a++}}return le=n[1],n[2].indexOf("K")>-1&&(fe.w|=V.KSIDE_CASTLE),n[2].indexOf("Q")>-1&&(fe.w|=V.QSIDE_CASTLE),n[2].indexOf("k")>-1&&(fe.b|=V.KSIDE_CASTLE),n[2].indexOf("q")>-1&&(fe.b|=V.QSIDE_CASTLE),pe="-"===n[3]?R:oe[n[3]],ce=parseInt(n[4],10),ue=parseInt(n[5],10),s(i()),!0}function o(e){var r={0:"No errors.",1:"FEN string must contain six space-delimited fields.",2:"6th field (move number) must be a positive integer.",3:"5th field (half move counter) must be a non-negative integer.",4:"4th field (en-passant square) is invalid.",5:"3rd field (castling availability) is invalid.",6:"2nd field (side to move) is invalid.",7:"1st field (piece positions) does not contain 8 '/'-delimited rows.",8:"1st field (piece positions) is invalid [consecutive numbers].",9:"1st field (piece positions) is invalid [invalid piece].",10:"1st field (piece positions) is invalid [row too large]."},n=e.split(/\s+/);if(6!==n.length)return{valid:!1,error_number:1,error:r[1]};if(isNaN(n[5])||parseInt(n[5],10)<=0)return{valid:!1,error_number:2,error:r[2]};if(isNaN(n[4])||parseInt(n[4],10)<0)return{valid:!1,error_number:3,error:r[3]};if(!/^(-|[abcdefgh][36])$/.test(n[3]))return{valid:!1,error_number:4,error:r[4]};if(!/^(KQ?k?q?|Qk?q?|kq?|q|-)$/.test(n[2]))return{valid:!1,error_number:5,error:r[5]};if(!/^(w|b)$/.test(n[1]))return{valid:!1,error_number:6,error:r[6]};var t=n[0].split("/");if(8!==t.length)return{valid:!1,error_number:7,error:r[7]};for(var o=0;o<t.length;o++){for(var i=0,a=!1,s=0;s<t[o].length;s++)if(isNaN(t[o][s])){if(!/^[prnbqkPRNBQK]$/.test(t[o][s]))return{valid:!1,error_number:9,error:r[9]};i+=1,a=!1}else{if(a)return{valid:!1,error_number:8,error:r[8]};i+=parseInt(t[o][s],10),a=!0}if(8!==i)return{valid:!1,error_number:10,error:r[10]}}return{valid:!0,error_number:0,error:r[0]}}function i(){for(var e=0,r="",n=oe.a8;n<=oe.h1;n++){if(null==ae[n])e++;else{e>0&&(r+=e,e=0);var t=ae[n].color,o=ae[n].type;r+=t===B?o.toUpperCase():o.toLowerCase()}n+1&136&&(e>0&&(r+=e),n!==oe.h1&&(r+="/"),e=0,n+=8)}var i="";fe[B]&V.KSIDE_CASTLE&&(i+="K"),fe[B]&V.QSIDE_CASTLE&&(i+="Q"),fe[N]&V.KSIDE_CASTLE&&(i+="k"),fe[N]&V.QSIDE_CASTLE&&(i+="q"),i=i||"-";var a=pe===R?"-":x(pe);return[r,le,i,a,ce,ue].join(" ")}function a(e){for(var r=0;r<e.length;r+=2)"string"==typeof e[r]&&"string"==typeof e[r+1]&&(he[e[r]]=e[r+1]);return he}function s(e){de.length>0||(e!==X?(he.SetUp="1",he.FEN=e):(delete he.SetUp,delete he.FEN))}function l(e){var r=ae[oe[e]];return r?{type:r.type,color:r.color}:null}function f(e,r){if(!("type"in e&&"color"in e))return!1;if(-1===J.indexOf(e.type.toLowerCase()))return!1;if(!(r in oe))return!1;var n=oe[r];return e.type==M&&se[e.color]!=R&&se[e.color]!=n?!1:(ae[n]={type:e.type,color:e.color},e.type===M&&(se[e.color]=n),s(i()),!0)}function p(e){var r=l(e);return ae[oe[e]]=null,r&&r.type===M&&(se[r.color]=R),s(i()),r}function c(e,r,n,t,o){var i={color:le,from:r,to:n,flags:t,piece:e[r].type};return o&&(i.flags|=V.PROMOTION,i.promotion=o),e[n]?i.captured=e[n].type:t&V.EP_CAPTURE&&(i.captured=D),i}function u(e){function r(e,r,n,t,o){if(e[n].type!==D||_(t)!==te&&_(t)!==ee)r.push(c(e,n,t,o));else for(var i=[j,U,Q,K],a=0,s=i.length;s>a;a++)r.push(c(e,n,t,o,i[a]))}var n=[],t=le,o=A(t),i={b:ne,w:re},a=oe.a8,s=oe.h1,l=!1,f="undefined"!=typeof e&&"legal"in e?e.legal:!0;if("undefined"!=typeof e&&"square"in e){if(!(e.square in oe))return[];a=s=oe[e.square],l=!0}for(var p=a;s>=p;p++)if(136&p)p+=7;else{var u=ae[p];if(null!=u&&u.color===t)if(u.type===D){var d=p+z[t][0];if(null==ae[d]){r(ae,n,p,d,V.NORMAL);var d=p+z[t][1];i[t]===_(p)&&null==ae[d]&&r(ae,n,p,d,V.BIG_PAWN)}for(g=2;4>g;g++){var d=p+z[t][g];136&d||(null!=ae[d]&&ae[d].color===o?r(ae,n,p,d,V.CAPTURE):d===pe&&r(ae,n,p,pe,V.EP_CAPTURE))}}else for(var g=0,m=W[u.type].length;m>g;g++)for(var b=W[u.type][g],d=p;;){if(d+=b,136&d)break;if(null!=ae[d]){if(ae[d].color===t)break;r(ae,n,p,d,V.CAPTURE);break}if(r(ae,n,p,d,V.NORMAL),"n"===u.type||"k"===u.type)break}}if(!l||s===se[t]){if(fe[t]&V.KSIDE_CASTLE){var w=se[t],y=w+2;null!=ae[w+1]||null!=ae[y]||h(o,se[t])||h(o,w+1)||h(o,y)||r(ae,n,se[t],y,V.KSIDE_CASTLE)}if(fe[t]&V.QSIDE_CASTLE){var w=se[t],y=w-2;null!=ae[w-1]||null!=ae[w-2]||null!=ae[w-3]||h(o,se[t])||h(o,w-1)||h(o,y)||r(ae,n,se[t],y,V.QSIDE_CASTLE)}}if(!f)return n;for(var E=[],p=0,m=n.length;m>p;p++)S(n[p]),v(t)||E.push(n[p]),P();return E}function d(e){var r="";if(e.flags&V.KSIDE_CASTLE)r="O-O";else if(e.flags&V.QSIDE_CASTLE)r="O-O-O";else{var n=C(e);e.piece!==D&&(r+=e.piece.toUpperCase()+n),e.flags&(V.CAPTURE|V.EP_CAPTURE)&&(e.piece===D&&(r+=x(e.from)[0]),r+="x"),r+=x(e.to),e.flags&V.PROMOTION&&(r+="="+e.promotion.toUpperCase())}return S(e),g()&&(r+=m()?"#":"+"),P(),r}function h(e,r){for(var n=oe.a8;n<=oe.h1;n++)if(136&n)n+=7;else if(null!=ae[n]&&ae[n].color===e){var t=ae[n],o=n-r,i=o+119;if(Y[i]&1<<H[t.type]){if(t.type===D){if(o>0){if(t.color===B)return!0}else if(t.color===N)return!0;continue}if("n"===t.type||"k"===t.type)return!0;for(var a=G[i],s=n+a,l=!1;s!==r;){if(null!=ae[s]){l=!0;break}s+=a}if(!l)return!0}}return!1}function v(e){return h(A(e),se[e])}function g(){return v(le)}function m(){return g()&&0===u().length}function b(){return!g()&&0===u().length}function w(){for(var e={},r=[],n=0,t=0,o=oe.a8;o<=oe.h1;o++)if(t=(t+1)%2,136&o)o+=7;else{var i=ae[o];i&&(e[i.type]=i.type in e?e[i.type]+1:1,i.type===Q&&r.push(t),n++)}if(2===n)return!0;if(3===n&&(1===e[Q]||1===e[K]))return!0;if(n===e[Q]+2){for(var a=0,s=r.length,o=0;s>o;o++)a+=r[o];if(0===a||a===s)return!0}return!1}function y(){for(var e=[],r={},n=!1;;){var t=P();if(!t)break;e.push(t)}for(;;){var o=i().split(" ").slice(0,4).join(" ");if(r[o]=o in r?r[o]+1:1,r[o]>=3&&(n=!0),!e.length)break;S(e.pop())}return n}function E(e){de.push({move:e,kings:{b:se.b,w:se.w},turn:le,castling:{b:fe.b,w:fe.w},ep_square:pe,half_moves:ce,move_number:ue})}function S(e){var r=le,n=A(r);if(E(e),ae[e.to]=ae[e.from],ae[e.from]=null,e.flags&V.EP_CAPTURE&&(le===N?ae[e.to-16]=null:ae[e.to+16]=null),e.flags&V.PROMOTION&&(ae[e.to]={type:e.promotion,color:r}),ae[e.to].type===M){if(se[ae[e.to].color]=e.to,e.flags&V.KSIDE_CASTLE){var t=e.to-1,o=e.to+1;ae[t]=ae[o],ae[o]=null}else if(e.flags&V.QSIDE_CASTLE){var t=e.to+1,o=e.to-2;ae[t]=ae[o],ae[o]=null}fe[r]=""}if(fe[r])for(var i=0,a=ie[r].length;a>i;i++)if(e.from===ie[r][i].square&&fe[r]&ie[r][i].flag){fe[r]^=ie[r][i].flag;break}if(fe[n])for(var i=0,a=ie[n].length;a>i;i++)if(e.to===ie[n][i].square&&fe[n]&ie[n][i].flag){fe[n]^=ie[n][i].flag;break}pe=e.flags&V.BIG_PAWN?"b"===le?e.to-16:e.to+16:R,e.piece===D?ce=0:e.flags&(V.CAPTURE|V.EP_CAPTURE)?ce=0:ce++,le===N&&ue++,le=A(le)}function P(){var e=de.pop();if(null==e)return null;var r=e.move;se=e.kings,le=e.turn,fe=e.castling,pe=e.ep_square,ce=e.half_moves,ue=e.move_number;var n=le,t=A(le);if(ae[r.from]=ae[r.to],ae[r.from].type=r.piece,ae[r.to]=null,r.flags&V.CAPTURE)ae[r.to]={type:r.captured,color:t};else if(r.flags&V.EP_CAPTURE){var o;o=n===N?r.to-16:r.to+16,ae[o]={type:D,color:t}}if(r.flags&(V.KSIDE_CASTLE|V.QSIDE_CASTLE)){var i,a;r.flags&V.KSIDE_CASTLE?(i=r.to+1,a=r.to-1):r.flags&V.QSIDE_CASTLE&&(i=r.to-2,a=r.to+1),ae[i]=ae[a],ae[a]=null}return r}function C(e){for(var r=u(),n=e.from,t=e.to,o=e.piece,i=0,a=0,s=0,l=0,f=r.length;f>l;l++){var p=r[l].from,c=r[l].to,d=r[l].piece;o===d&&n!==p&&t===c&&(i++,_(n)===_(p)&&a++,$(n)===$(p)&&s++)}return i>0?a>0&&s>0?x(n):x(n).charAt(s>0?1:0):""}function O(){for(var e="   +------------------------+\n",r=oe.a8;r<=oe.h1;r++){if(0===$(r)&&(e+=" "+"87654321"[_(r)]+" |"),null==ae[r])e+=" . ";else{var n=ae[r].type,t=ae[r].color,o=t===B?n.toUpperCase():n.toLowerCase();e+=" "+o+" "}r+1&136&&(e+="|\n",r+=8)}return e+="   +------------------------+\n",e+="     a  b  c  d  e  f  g  h\n"}function _(e){return e>>4}function $(e){return 15&e}function x(e){var r=$(e),n=_(e);return"abcdefgh".substring(r,r+1)+"87654321".substring(n,n+1)}function A(e){return e===B?N:B}function T(e){return-1!=="0123456789".indexOf(e)}function k(e){var r=I(e);r.san=d(r),r.to=x(r.to),r.from=x(r.from);var n="";for(var t in V)V[t]&r.flags&&(n+=Z[t]);return r.flags=n,r}function I(e){var r=e instanceof Array?[]:{};for(var n in e)r[n]="object"==typeof n?I(e[n]):e[n];return r}function q(e){return e.replace(/^\s+|\s+$/g,"")}function L(e){for(var r=u({legal:!1}),n=0,t=le,o=0,i=r.length;i>o;o++){if(S(r[o]),!v(t))if(e-1>0){var a=L(e-1);n+=a}else n++;P()}return n}var N="b",B="w",R=-1,D="p",K="n",Q="b",U="r",j="q",M="k",J="pnbrqkPNBRQK",X="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",F=["1-0","0-1","1/2-1/2","*"],z={b:[16,32,17,15],w:[-16,-32,-17,-15]},W={n:[-18,-33,-31,-14,18,33,31,14],b:[-17,-15,17,15],r:[-16,1,16,-1],q:[-17,-16,-15,1,17,16,15,-1],k:[-17,-16,-15,1,17,16,15,-1]},Y=[20,0,0,0,0,0,0,24,0,0,0,0,0,0,20,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,24,24,24,24,24,24,56,0,56,24,24,24,24,24,24,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,20,0,0,0,0,0,0,24,0,0,0,0,0,0,20],G=[17,0,0,0,0,0,0,16,0,0,0,0,0,0,15,0,0,17,0,0,0,0,0,16,0,0,0,0,0,15,0,0,0,0,17,0,0,0,0,16,0,0,0,0,15,0,0,0,0,0,0,17,0,0,0,16,0,0,0,15,0,0,0,0,0,0,0,0,17,0,0,16,0,0,15,0,0,0,0,0,0,0,0,0,0,17,0,16,0,15,0,0,0,0,0,0,0,0,0,0,0,0,17,16,15,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,-15,-16,-17,0,0,0,0,0,0,0,0,0,0,0,0,-15,0,-16,0,-17,0,0,0,0,0,0,0,0,0,0,-15,0,0,-16,0,0,-17,0,0,0,0,0,0,0,0,-15,0,0,0,-16,0,0,0,-17,0,0,0,0,0,0,-15,0,0,0,0,-16,0,0,0,0,-17,0,0,0,0,-15,0,0,0,0,0,-16,0,0,0,0,0,-17,0,0,-15,0,0,0,0,0,0,-16,0,0,0,0,0,0,-17],H={p:0,n:1,b:2,r:3,q:4,k:5},Z={NORMAL:"n",CAPTURE:"c",BIG_PAWN:"b",EP_CAPTURE:"e",PROMOTION:"p",KSIDE_CASTLE:"k",QSIDE_CASTLE:"q"},V={NORMAL:1,CAPTURE:2,BIG_PAWN:4,EP_CAPTURE:8,PROMOTION:16,KSIDE_CASTLE:32,QSIDE_CASTLE:64},ee=7,re=6,ne=1,te=0,oe={a8:0,b8:1,c8:2,d8:3,e8:4,f8:5,g8:6,h8:7,a7:16,b7:17,c7:18,d7:19,e7:20,f7:21,g7:22,h7:23,a6:32,b6:33,c6:34,d6:35,e6:36,f6:37,g6:38,h6:39,a5:48,b5:49,c5:50,d5:51,e5:52,f5:53,g5:54,h5:55,a4:64,b4:65,c4:66,d4:67,e4:68,f4:69,g4:70,h4:71,a3:80,b3:81,c3:82,d3:83,e3:84,f3:85,g3:86,h3:87,a2:96,b2:97,c2:98,d2:99,e2:100,f2:101,g2:102,h2:103,a1:112,b1:113,c1:114,d1:115,e1:116,f1:117,g1:118,h1:119},ie={w:[{square:oe.a1,flag:V.QSIDE_CASTLE},{square:oe.h1,flag:V.KSIDE_CASTLE}],b:[{square:oe.a8,flag:V.QSIDE_CASTLE},{square:oe.h8,flag:V.KSIDE_CASTLE}]},ae=new Array(128),se={w:R,b:R},le=B,fe={w:0,b:0},pe=R,ce=0,ue=1,de=[],he={};return t("undefined"==typeof e?X:e),{WHITE:B,BLACK:N,PAWN:D,KNIGHT:K,BISHOP:Q,ROOK:U,QUEEN:j,KING:M,SQUARES:function(){for(var e=[],r=oe.a8;r<=oe.h1;r++)136&r?r+=7:e.push(x(r));return e}(),FLAGS:Z,load:function(e){return t(e)},reset:function(){return n()},moves:function(e){for(var r=u(e),n=[],t=0,o=r.length;o>t;t++)n.push("undefined"!=typeof e&&"verbose"in e&&e.verbose?k(r[t]):d(r[t]));return n},in_check:function(){return g()},in_checkmate:function(){return m()},in_stalemate:function(){return b()},in_draw:function(){return ce>=100||b()||w()||y()},insufficient_material:function(){return w()},in_threefold_repetition:function(){return y()},game_over:function(){return ce>=100||m()||b()||w()||y()},validate_fen:function(e){return o(e)},fen:function(){return i()},pgn:function(e){var r="object"==typeof e&&"string"==typeof e.newline_char?e.newline_char:"\n",n="object"==typeof e&&"number"==typeof e.max_width?e.max_width:0,t=[],o=!1;for(var i in he)t.push("["+i+' "'+he[i]+'"]'+r),o=!0;o&&de.length&&t.push(r);for(var a=[];de.length>0;)a.push(P());for(var s=[],l="",f=1;a.length>0;){var p=a.pop();1===f&&"b"===p.color?(l="1. ...",f++):"w"===p.color&&(l.length&&s.push(l),l=f+".",f++),l=l+" "+d(p),S(p)}if(l.length&&s.push(l),"undefined"!=typeof he.Result&&s.push(he.Result),0===n)return t.join("")+s.join(" ");for(var c=0,i=0;i<s.length;i++)c+s[i].length>n&&0!==i?(" "===t[t.length-1]&&t.pop(),t.push(r),c=0):0!==i&&(t.push(" "),c++),t.push(s[i]),c+=s[i].length;return t.join("")},load_pgn:function(e,r){function o(e){return e.replace(/\\/g,"\\")}function i(e){for(var r=e.replace(/[+#?!=]/,""),n=u(),t=0,o=n.length;o>t;t++)if(r==d(n[t]).replace(/[+#?!=]/,""))return n[t];return null}function s(e){return i(q(e))}function l(e){var r=!1;for(var n in e)r=!0;return r}function f(e,r){for(var n="object"==typeof r&&"string"==typeof r.newline_char?r.newline_char:"\r?\n",t={},i=e.split(new RegExp(o(n))),a="",s="",l=0;l<i.length;l++)a=i[l].replace(/^\[([A-Z][A-Za-z]*)\s.*\]$/,"$1"),s=i[l].replace(/^\[[A-Za-z]+\s"(.*)"\]$/,"$1"),q(a).length>0&&(t[a]=s);return t}var p="object"==typeof r&&"string"==typeof r.newline_char?r.newline_char:"\r?\n",c=new RegExp("^(\\[(.|"+o(p)+")*\\])("+o(p)+")*1.("+o(p)+"|.)*$","g"),h=e.replace(c,"$1");"["!==h[0]&&(h=""),n();var v=f(h,r);for(var g in v)a([g,v[g]]);if("1"===v.SetUp&&!("FEN"in v&&t(v.FEN)))return!1;var m=e.replace(h,"").replace(new RegExp(o(p),"g")," ");m=m.replace(/(\{[^}]+\})+?/g,""),m=m.replace(/\d+\./g,""),m=m.replace(/\.\.\./g,"");var b=q(m).split(new RegExp(/\s+/));b=b.join(",").replace(/,,+/g,",").split(",");for(var w="",y=0;y<b.length-1;y++){if(w=s(b[y]),null==w)return!1;S(w)}if(w=b[b.length-1],F.indexOf(w)>-1)l(he)&&"undefined"==typeof he.Result&&a(["Result",w]);else{if(w=s(w),null==w)return!1;S(w)}return!0},header:function(){return a(arguments)},ascii:function(){return O()},turn:function(){return le},move:function(e){var r=null,n=u();if("string"==typeof e){for(var t=e.replace(/[+#?!=]/,""),o=0,i=n.length;i>o;o++)if(t===d(n[o]).replace(/[+#?!=]/,"")){r=n[o];break}}else if("object"==typeof e)for(var o=0,i=n.length;i>o;o++)if(!(e.from!==x(n[o].from)||e.to!==x(n[o].to)||"promotion"in n[o]&&e.promotion!==n[o].promotion)){r=n[o];break}if(!r)return null;var a=k(r);return S(r),a},undo:function(){var e=P();return e?k(e):null},clear:function(){return r()},put:function(e,r){return f(e,r)},get:function(e){return l(e)},remove:function(e){return p(e)},perft:function(e){return L(e)},square_color:function(e){if(e in oe){var r=oe[e];return(_(r)+$(r))%2===0?"light":"dark"}return null},history:function(e){for(var r=[],n=[],t=("undefined"!=typeof e&&"verbose"in e&&e.verbose);de.length>0;)r.push(P());for(;r.length>0;){var o=r.pop();n.push(t?k(o):d(o)),S(o)}return n}}};"undefined"!=typeof exports&&(exports.Chess=Chess),"undefined"!=typeof define&&define(function(){return Chess}),function(){function e(e){return"string"!=typeof e?!1:-1!==e.search(/^[a-h][1-8]$/)}function r(e){if("string"!=typeof e)return!1;if(e=e.replace(/ .+$/,""),e=e.split("/"),8!==e.length)return!1;for(var r=0;8>r;r++)if(""===e[r]||8<e[r].length||-1!==e[r].search(/[^kqrbnpKQRNBP1-8]/))return!1;return!0}function n(r){if("object"!=typeof r)return!1;for(var n in r)if(!0===r.hasOwnProperty(n)){var t;if((t=!0!==e(n))||(t=r[n],t="string"!=typeof t?!1:-1!==t.search(/^[bw][KQRNBP]$/),t=!0!==t),t)return!1}return!0}function t(e){if(!0!==r(e))return!1;e=e.replace(/ .+$/,""),e=e.split("/");for(var n={},t=8,o=0;8>o;o++){for(var a=e[o].split(""),s=0,l=0;l<a.length;l++)if(-1!==a[l].search(/[1-8]/))var f=parseInt(a[l],10),s=s+f;else{var p,f=n,c=i[s]+t;p=a[l],p=p.toLowerCase()===p?"b"+p.toUpperCase():"w"+p.toUpperCase(),f[c]=p,s++}t--}return n}function o(e){if(!0!==n(e))return!1;for(var r="",t=8,o=0;8>o;o++){for(var a=0;8>a;a++){var s=i[a]+t;!0===e.hasOwnProperty(s)?(s=e[s].split(""),s="w"===s[0]?s[1].toUpperCase():s[1].toLowerCase(),r+=s):r+="1"}7!==o&&(r+="/"),t--}return r=r.replace(/11111111/g,"8"),r=r.replace(/1111111/g,"7"),r=r.replace(/111111/g,"6"),r=r.replace(/11111/g,"5"),r=r.replace(/1111/g,"4"),r=r.replace(/111/g,"3"),r=r.replace(/11/g,"2")}var i="abcdefgh".split("");window.ChessBoard=window.ChessBoard||function(a,s){function l(){return"xxxx-xxxx-xxxx-xxxx-xxxx-xxxx-xxxx-xxxx".replace(/x/g,function(e){return(16*Math.random()|0).toString(16)})}function f(e){return JSON.parse(JSON.stringify(e))}function p(e){return e=e.split("."),{major:parseInt(e[0],10),minor:parseInt(e[1],10),patch:parseInt(e[2],10)}}function c(e,r,n){if(!0===s.hasOwnProperty("showErrors")&&!1!==s.showErrors){var t="ChessBoard Error "+e+": "+r;"console"===s.showErrors&&"object"==typeof console&&"function"==typeof console.log?(console.log(t),2<=arguments.length&&console.log(n)):"alert"===s.showErrors?(n&&(t+="\n\n"+JSON.stringify(n)),window.alert(t)):"function"==typeof s.showErrors&&s.showErrors(e,r,n)}}function u(e){return"fast"===e||"slow"===e?!0:parseInt(e,10)+""!=e+""?!1:e>=0}function d(){for(var e=0;e<i.length;e++)for(var r=1;8>=r;r++){var n=i[e]+r;de[n]=n+"-"+l()}for(r="KQRBNP".split(""),e=0;e<r.length;e++){var n="w"+r[e],t="b"+r[e];ue[n]=n+"-"+l(),ue[t]=t+"-"+l()}}function h(){var e='<div class="'+ae.chessboard+'">';return!0===s.sparePieces&&(e+='<div class="'+ae.sparePieces+" "+ae.sparePiecesTop+'"></div>'),e+='<div class="'+ae.board+'"></div>',!0===s.sparePieces&&(e+='<div class="'+ae.sparePieces+" "+ae.sparePiecesBottom+'"></div>'),e+"</div>"}function v(e){"black"!==e&&(e="white");var r="",n=f(i),t=8;"black"===e&&(n.reverse(),t=1);for(var o="white",a=0;8>a;a++){for(var r=r+('<div class="'+ae.row+'">'),l=0;8>l;l++){var p=n[l]+t,r=r+('<div class="'+ae.square+" "+ae[o]+" square-"+p+'" style="width: '+ee+"px; height: "+ee+'px" id="'+de[p]+'" data-square="'+p+'">');!0===s.showNotation&&(("white"===e&&1===t||"black"===e&&8===t)&&(r+='<div class="'+ae.notation+" "+ae.alpha+'">'+n[l]+"</div>"),0===l&&(r+='<div class="'+ae.notation+" "+ae.numeric+'">'+t+"</div>")),r+="</div>",o="white"===o?"black":"white"}r+='<div class="'+ae.clearfix+'"></div></div>',o="white"===o?"black":"white","white"===e?t--:t++}return r}function g(e){return"function"==typeof s.pieceTheme?s.pieceTheme(e):"string"==typeof s.pieceTheme?s.pieceTheme.replace(/{piece}/g,e):(c(8272,"Unable to build image source for cfg.pieceTheme."),"")}function m(e,r,n){var t='<img src="'+g(e)+'" ';return n&&"string"==typeof n&&(t+='id="'+n+'" '),t+='alt="" class="'+ae.piece+'" data-piece="'+e+'" style="width: '+ee+"px;height: "+ee+"px;",!0===r&&(t+="display:none;"),t+'" />'}function b(e){var r="wK wQ wR wB wN wP".split(" ");"black"===e&&(r="bK bQ bR bB bN bP".split(" ")),e="";for(var n=0;n<r.length;n++)e+=m(r[n],!1,ue[r[n]]);return e}function w(e,r,n,t){e=$("#"+de[e]);var o=e.offset(),i=$("#"+de[r]);r=i.offset();var a=l();$("body").append(m(n,!0,a));var f=$("#"+a);f.css({display:"",position:"absolute",top:o.top,left:o.left}),e.find("."+ae.piece).remove(),f.animate(r,{duration:s.moveSpeed,complete:function(){i.append(m(n)),f.remove(),"function"==typeof t&&t()}})}function y(e,r,n){var t=$("#"+ue[e]).offset(),o=$("#"+de[r]);r=o.offset();var i=l();$("body").append(m(e,!0,i));var a=$("#"+i);a.css({display:"",position:"absolute",left:t.left,top:t.top}),a.animate(r,{duration:s.moveSpeed,complete:function(){o.find("."+ae.piece).remove(),o.append(m(e)),a.remove(),"function"==typeof n&&n()}})}function E(e,r,n){function t(){o++,o===e.length&&(C(),!0===s.hasOwnProperty("onMoveEnd")&&"function"==typeof s.onMoveEnd)&&s.onMoveEnd(f(r),f(n))}for(var o=0,i=0;i<e.length;i++)"clear"===e[i].type&&$("#"+de[e[i].square]+" ."+ae.piece).fadeOut(s.trashSpeed,t),"add"===e[i].type&&!0!==s.sparePieces&&$("#"+de[e[i].square]).append(m(e[i].piece,!0)).find("."+ae.piece).fadeIn(s.appearSpeed,t),"add"===e[i].type&&!0===s.sparePieces&&y(e[i].piece,e[i].square,t),"move"===e[i].type&&w(e[i].source,e[i].destination,e[i].piece,t)}function S(e,r){e=e.split("");var n=i.indexOf(e[0])+1,t=parseInt(e[1],10);r=r.split("");var o=i.indexOf(r[0])+1,a=parseInt(r[1],10),n=Math.abs(n-o),t=Math.abs(t-a);return n>=t?n:t}function P(e){for(var r=[],n=0;8>n;n++)for(var t=0;8>t;t++){var o=i[n]+(t+1);e!==o&&r.push({square:o,distance:S(e,o)})}for(r.sort(function(e,r){return e.distance-r.distance}),e=[],n=0;n<r.length;n++)e.push(r[n].square);return e}function C(){G.find("."+ae.piece).remove();for(var e in pe)!0===pe.hasOwnProperty(e)&&$("#"+de[e]).append(m(pe[e]))}function O(){G.html(v(fe)),C(),!0===s.sparePieces&&("white"===fe?(Z.html(b("black")),V.html(b("white"))):(Z.html(b("white")),V.html(b("black"))))}function _(e){var r=f(pe),n=f(e),t=o(r),i=o(n);t!==i&&(!0===s.hasOwnProperty("onChange")&&"function"==typeof s.onChange&&s.onChange(r,n),pe=e)}function x(e,r){for(var n in oe)if(!0===oe.hasOwnProperty(n)){var t=oe[n];if(e>=t.left&&e<t.left+ee&&r>=t.top&&r<t.top+ee)return n}return"offboard"}function A(){G.find("."+ae.square).removeClass(ae.highlight1+" "+ae.highlight2)}function T(){function e(){C(),H.css("display","none"),!0===s.hasOwnProperty("onSnapbackEnd")&&"function"==typeof s.onSnapbackEnd&&s.onSnapbackEnd(re,te,f(pe),fe)}if("spare"===te)k();else{A();var r=$("#"+de[te]).offset();H.animate(r,{duration:s.snapbackSpeed,complete:e}),ce=!1}}function k(){A();var e=f(pe);delete e[te],_(e),C(),H.fadeOut(s.trashSpeed),ce=!1}function I(e){A();var r=f(pe);delete r[te],r[e]=re,_(r),r=$("#"+de[e]).offset(),H.animate(r,{duration:s.snapSpeed,complete:function(){C(),H.css("display","none"),!0===s.hasOwnProperty("onSnapEnd")&&"function"==typeof s.onSnapEnd&&s.onSnapEnd(te,e,re)}}),ce=!1}function q(e,r,n,t){if("function"!=typeof s.onDragStart||!1!==s.onDragStart(e,r,f(pe),fe)){ce=!0,re=r,te=e,ne="spare"===e?"offboard":e,oe={};for(var o in de)!0===de.hasOwnProperty(o)&&(oe[o]=$("#"+de[o]).offset());H.attr("src",g(r)).css({display:"",position:"absolute",left:n-ee/2,top:t-ee/2}),"spare"!==e&&$("#"+de[e]).addClass(ae.highlight1).find("."+ae.piece).css("display","none")}}function L(r,n){H.css({left:r-ee/2,top:n-ee/2});var t=x(r,n);t!==ne&&(!0===e(ne)&&$("#"+de[ne]).removeClass(ae.highlight2),!0===e(t)&&$("#"+de[t]).addClass(ae.highlight2),"function"==typeof s.onDragMove&&s.onDragMove(t,ne,te,re,f(pe),fe),ne=t)}function N(r){var n="drop";if("offboard"===r&&"snapback"===s.dropOffBoard&&(n="snapback"),"offboard"===r&&"trash"===s.dropOffBoard&&(n="trash"),!0===s.hasOwnProperty("onDrop")&&"function"==typeof s.onDrop){var t=f(pe);"spare"===te&&!0===e(r)&&(t[r]=re),!0===e(te)&&"offboard"===r&&delete t[te],!0===e(te)&&!0===e(r)&&(delete t[te],t[r]=re);var o=f(pe),t=s.onDrop(te,r,re,t,o,fe);("snapback"===t||"trash"===t)&&(n=t)}"snapback"===n?T():"trash"===n?k():"drop"===n&&I(r)}function B(e){e.preventDefault()}function R(r){if(!0===s.draggable){var n=$(this).attr("data-square");!0===e(n)&&!0===pe.hasOwnProperty(n)&&q(n,pe[n],r.pageX,r.pageY)}}function D(r){if(!0===s.draggable){var n=$(this).attr("data-square");!0===e(n)&&!0===pe.hasOwnProperty(n)&&(r=r.originalEvent,q(n,pe[n],r.changedTouches[0].pageX,r.changedTouches[0].pageY))}}function K(e){if(!0===s.sparePieces){var r=$(this).attr("data-piece");q("spare",r,e.pageX,e.pageY)}}function Q(e){if(!0===s.sparePieces){var r=$(this).attr("data-piece");e=e.originalEvent,q("spare",r,e.changedTouches[0].pageX,e.changedTouches[0].pageY)}}function U(e){!0===ce&&L(e.pageX,e.pageY)}function j(e){!0===ce&&(e.preventDefault(),L(e.originalEvent.changedTouches[0].pageX,e.originalEvent.changedTouches[0].pageY))}function M(e){!0===ce&&(e=x(e.pageX,e.pageY),N(e))}function J(e){!0===ce&&(e=x(e.originalEvent.changedTouches[0].pageX,e.originalEvent.changedTouches[0].pageY),N(e))}function X(r){if(!1===ce&&!0===s.hasOwnProperty("onMouseoverSquare")&&"function"==typeof s.onMouseoverSquare&&(r=$(r.currentTarget).attr("data-square"),!0===e(r))){var n=!1;!0===pe.hasOwnProperty(r)&&(n=pe[r]),s.onMouseoverSquare(r,n,f(pe),fe)}}function F(r){if(!1===ce&&!0===s.hasOwnProperty("onMouseoutSquare")&&"function"==typeof s.onMouseoutSquare&&(r=$(r.currentTarget).attr("data-square"),!0===e(r))){var n=!1;!0===pe.hasOwnProperty(r)&&(n=pe[r]),s.onMouseoutSquare(r,n,f(pe),fe)}}function z(){$("body").on("mousedown mousemove","."+ae.piece,B),G.on("mousedown","."+ae.square,R),Y.on("mousedown","."+ae.sparePieces+" ."+ae.piece,K),G.on("mouseenter","."+ae.square,X),G.on("mouseleave","."+ae.square,F),!0===(navigator&&navigator.userAgent&&-1!==navigator.userAgent.search(/MSIE/))?(document.ondragstart=function(){return!1},$("body").on("mousemove",U),$("body").on("mouseup",M)):($(window).on("mousemove",U),$(window).on("mouseup",M)),!0=="ontouchstart"in document.documentElement&&(G.on("touchstart","."+ae.square,D),Y.on("touchstart","."+ae.sparePieces+" ."+ae.piece,Q),$(window).on("touchmove",j),$(window).on("touchend",J))}function W(){Y.html(h()),G=Y.find("."+ae.board),!0===s.sparePieces&&(Z=Y.find("."+ae.sparePiecesTop),V=Y.find("."+ae.sparePiecesBottom));var e=l();$("body").append(m("wP",!0,e)),H=$("#"+e),le=parseInt(G.css("borderLeftWidth"),10),se.resize()}s=s||{};var Y,G,H,Z,V,ee,re,ne,te,oe,ie=t("rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR"),ae={alpha:"alpha-d2270",black:"black-3c85d",board:"board-b72b1",chessboard:"chessboard-63f37",clearfix:"clearfix-7da63",highlight1:"highlight1-32417",highlight2:"highlight2-9c5d2",notation:"notation-322f9",numeric:"numeric-fc462",piece:"piece-417db",row:"row-5277c",sparePieces:"spare-pieces-7492f",sparePiecesBottom:"spare-pieces-bottom-ae20f",sparePiecesTop:"spare-pieces-top-4028b",square:"square-55d63",white:"white-1e1d7"},se={},le=2,fe="white",pe={},ce=!1,ue={},de={};se.clear=function(e){se.position({},e)},se.destroy=function(){Y.html(""),H.remove(),Y.unbind()},se.fen=function(){return se.position("fen")},se.flip=function(){se.orientation("flip")},se.move=function(){if(0!==arguments.length){for(var r=!0,n={},t=0;t<arguments.length;t++)if(!1===arguments[t])r=!1;else{var o;o=arguments[t],"string"!=typeof o?o=!1:(o=o.split("-"),o=2!==o.length?!1:!0===e(o[0])&&!0===e(o[1])),!0!==o?c(2826,"Invalid move passed to the move method.",arguments[t]):(o=arguments[t].split("-"),n[o[0]]=o[1])}var i,t=pe,t=f(t);for(i in n)!0===n.hasOwnProperty(i)&&!0===t.hasOwnProperty(i)&&(o=t[i],delete t[i],t[n[i]]=o);return n=t,se.position(n,r),n}},se.orientation=function(e){return 0===arguments.length?fe:void("white"===e||"black"===e?(fe=e,O()):"flip"===e?(fe="white"===fe?"black":"white",O()):c(5482,"Invalid value passed to the orientation method.",e))},se.position=function(e,i){if(0===arguments.length)return f(pe);if("string"==typeof e&&"fen"===e.toLowerCase())return o(pe);if(!1!==i&&(i=!0),"string"==typeof e&&"start"===e.toLowerCase()&&(e=f(ie)),!0===r(e)&&(e=t(e)),!0!==n(e))c(6482,"Invalid value passed to the position method.",e);else if(!0===i){var a,s=pe,l=e,s=f(s),l=f(l),p=[],u={};for(a in l)!0===l.hasOwnProperty(a)&&!0===s.hasOwnProperty(a)&&s[a]===l[a]&&(delete s[a],delete l[a]);for(a in l)if(!0===l.hasOwnProperty(a)){var d;e:{d=s;for(var h=l[a],v=P(a),g=0;g<v.length;g++){var m=v[g];if(!0===d.hasOwnProperty(m)&&d[m]===h){d=m;break e}}d=!1}!1!==d&&(p.push({type:"move",source:d,destination:a,piece:l[a]}),delete s[d],delete l[a],u[a]=!0)}for(a in l)!0===l.hasOwnProperty(a)&&(p.push({type:"add",square:a,piece:l[a]}),delete l[a]);for(a in s)!0===s.hasOwnProperty(a)&&!0!==u.hasOwnProperty(a)&&(p.push({type:"clear",square:a,piece:s[a]}),delete s[a]);E(p,pe,e),_(e)}else _(e),C()},se.resize=function(){var e=parseInt(Y.css("width"),10);if(!e||0>=e)ee=0;else{for(e-=1;0!==e%8&&e>0;)e--;ee=e/8}G.css("width",8*ee+"px"),H.css({height:ee,width:ee}),!0===s.sparePieces&&Y.find("."+ae.sparePieces).css("paddingLeft",ee+le+"px"),O()},se.start=function(e){se.position("start",e)};var he;return(he=!0===function(){if("string"==typeof a){if(""===a)return window.alert("ChessBoard Error 1001: The first argument to ChessBoard() cannot be an empty string.\n\nExiting..."),!1;var e=document.getElementById(a);if(!e)return window.alert('ChessBoard Error 1002: Element with id "'+a+'" does not exist in the DOM.\n\nExiting...'),!1;Y=$(e)}else if(Y=$(a),1!==Y.length)return window.alert("ChessBoard Error 1003: The first argument to ChessBoard() must be an ID or a single DOM node.\n\nExiting..."),!1;if(!window.JSON||"function"!=typeof JSON.stringify||"function"!=typeof JSON.parse)return window.alert("ChessBoard Error 1004: JSON does not exist. Please include a JSON polyfill.\n\nExiting..."),!1;if((e=typeof window.$)&&(e=$.fn)&&(e=$.fn.jquery))var e=$.fn.jquery,r="1.7.0",e=p(e),r=p(r),e=!0==1e8*e.major+1e4*e.minor+e.patch>=1e8*r.major+1e4*r.minor+r.patch;

return e?!0:(window.alert("ChessBoard Error 1005: Unable to find a valid version of jQuery. Please include jQuery 1.7.0 or higher on the page.\n\nExiting..."),!1)}())&&(("string"==typeof s||!0===n(s))&&(s={position:s}),"black"!==s.orientation&&(s.orientation="white"),fe=s.orientation,!1!==s.showNotation&&(s.showNotation=!0),!0!==s.draggable&&(s.draggable=!1),"trash"!==s.dropOffBoard&&(s.dropOffBoard="snapback"),!0!==s.sparePieces&&(s.sparePieces=!1),!0===s.sparePieces&&(s.draggable=!0),(!0!==s.hasOwnProperty("pieceTheme")||"string"!=typeof s.pieceTheme&&"function"!=typeof s.pieceTheme)&&(s.pieceTheme="img/chesspieces/wikipedia/{piece}.png"),(!0!==s.hasOwnProperty("appearSpeed")||!0!==u(s.appearSpeed))&&(s.appearSpeed=200),(!0!==s.hasOwnProperty("moveSpeed")||!0!==u(s.moveSpeed))&&(s.moveSpeed=200),(!0!==s.hasOwnProperty("snapbackSpeed")||!0!==u(s.snapbackSpeed))&&(s.snapbackSpeed=50),(!0!==s.hasOwnProperty("snapSpeed")||!0!==u(s.snapSpeed))&&(s.snapSpeed=25),(!0!==s.hasOwnProperty("trashSpeed")||!0!==u(s.trashSpeed))&&(s.trashSpeed=100),!0===s.hasOwnProperty("position")&&("start"===s.position?pe=f(ie):!0===r(s.position)?pe=t(s.position):!0===n(s.position)?pe=f(s.position):c(7263,"Invalid value passed to config.position.",s.position)),he=!0),he&&(d(),W(),z()),se},window.ChessBoard.fenToObj=t,window.ChessBoard.objToFen=o}(),$(document).ready(function(){$(document).on("scroll",onScroll),$("a[href^='#']").on("click",function(e){e.preventDefault(),$(document).off("scroll"),$("a").each(function(){$(this).removeClass("active")}),$(this).addClass("active");var r=this.hash,n=$(r);$("html, body").stop().animate({scrollTop:n.offset().top+2},500,"swing",function(){window.location.hash=r,$(document).on("scroll",onScroll)})})});